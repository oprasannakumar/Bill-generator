<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Bill Builder</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  font-family: Arial, sans-serif;
  background:#f5f5f5;
  padding:20px;
  display:flex;
  justify-content:center;
}

.container{
  width:100%;
  max-width:520px;
  background:#fff;
  padding:18px;
  border-radius:8px;
  box-shadow:0 0 10px rgba(0,0,0,.1);
}

label{
  font-size:13px;
  font-weight:600;
  display:block;
  margin-top:12px;
}

/* âœ… PERFECT SIZE NORMALIZATION */
select,
input{
  width:100%;
  height:38px;
  padding:0 8px;
  border-radius:4px;
  border:1px solid #ccc;
  font-size:14px;
  background:#fff;
  box-sizing:border-box;
  line-height:38px;
  color:#000;
}

/* Remove number arrows */
input[type=number]::-webkit-inner-spin-button,
input[type=number]::-webkit-outer-spin-button{
  -webkit-appearance:none;
  margin:0;
}
input[type=number]{
  -moz-appearance:textfield;
}

/* Dropdown fix for Android */
select{
  -webkit-appearance:none;
  -moz-appearance:none;
  appearance:none;
}

/* GRID ALIGNMENT */
.item-row{
  display:grid;
  grid-template-columns: 1.6fr 0.7fr 0.7fr 36px;
  gap:8px;
  align-items:center;
  margin-top:10px;
}

.item-total{
  font-weight:bold;
  text-align:right;
}

.delete-btn{
  background:#dc3545;
  color:#fff;
  border:none;
  border-radius:4px;
  height:36px;
  cursor:pointer;
}

/* Buttons */
button{
  width:100%;
  height:40px;
  margin-top:14px;
  border:none;
  border-radius:4px;
  cursor:pointer;
  font-size:14px;
}
.add-btn{background:#28a745;color:#fff}
.gen-btn{background:#007bff;color:#fff}

/* BILL */
.bill-box{
  margin-top:20px;
  padding:14px;
  background:#e9ecef;
  border-radius:6px;
}
.bill-row{
  display:flex;
  justify-content:space-between;
  margin-top:6px;
}
.bill-grand{
  font-weight:bold;
  font-size:16px;
  margin-top:10px;
}
.hidden{display:none}
</style>
</head>

<body>

<div class="container">

  <label>Select Dealer</label>
  <select id="dealerSelect" onchange="loadItems()">
    <option value="">-- Select Dealer --</option>
  </select>

  <div id="itemsContainer"></div>

  <button class="add-btn" onclick="addItem()">âž• Add Item</button>
  <button class="gen-btn" onclick="generateBill()">Generate Bill</button>

  <!-- FINAL BILL -->
  <div id="billBox" class="bill-box hidden"></div>

</div>

<script>
const API_URL =
"https://script.google.com/macros/s/AKfycbzRt_ad2rXgZNVO4_Nlumm8EAxN7jcG7gG1y0yKEec7WXnws68ygcAqrhCjRzcmdWzl/exec";
const API_KEY = "9848o22338B!";

let groceries = {};
let dealerItems = [];

window.onload = () => {
  fetch(`${API_URL}?key=${API_KEY}`)
    .then(r => r.json())
    .then(d => {
      groceries = d || {};
      populateDealers();
    });
};

function populateDealers(){
  const set = new Set();
  Object.values(groceries).forEach(a =>
    a.forEach(d => set.add(d.dealer))
  );
  [...set].sort().forEach(d =>
    dealerSelect.add(new Option(d, d))
  );
}

function loadItems(){
  itemsContainer.innerHTML = "";
  billBox.classList.add("hidden");
  dealerItems = [];

  const dealer = dealerSelect.value;
  if(!dealer) return;

  Object.keys(groceries).forEach(item => {
    groceries[item].forEach(d => {
      if(d.dealer === dealer){
        dealerItems.push({ item, price: d.price });
      }
    });
  });

  dealerItems.sort((a,b)=>a.item.localeCompare(b.item));
}

function addItem(){
  if(!dealerItems.length) return;

  const row = document.createElement("div");
  row.className = "item-row";

  const sel = document.createElement("select");
  sel.innerHTML =
    `<option value="">Item</option>` +
    dealerItems.map(i =>
      `<option value="${i.item}" data-price="${i.price}">
        ${i.item}
      </option>`
    ).join("");

  const qty = document.createElement("input");
  qty.type = "number";
  qty.min = "0";
  qty.placeholder = "Qty";

  const total = document.createElement("div");
  total.className = "item-total";
  total.textContent = "â‚¹0";

  const del = document.createElement("button");
  del.textContent = "ðŸ—‘";
  del.className = "delete-btn";
  del.onclick = () => row.remove();

  function recalc(){
    const price = Number(sel.selectedOptions[0]?.dataset.price || 0);
    const q = Number(qty.value || 0);
    total.textContent = `â‚¹${price * q}`;
  }

  sel.onchange = recalc;
  qty.oninput = recalc;

  row.append(sel, qty, total, del);
  itemsContainer.appendChild(row);
}

function generateBill(){
  billBox.innerHTML = "<b>Final Bill</b>";
  let grand = 0;

  document.querySelectorAll(".item-row").forEach(r => {
    const sel = r.children[0];
    const qty = Number(r.children[1].value);
    if(!sel.value || !qty) return;

    const price = Number(sel.selectedOptions[0].dataset.price);
    const total = qty * price;
    grand += total;

    billBox.innerHTML += `
      <div class="bill-row">
        <span>${sel.value} (${qty} Ã— â‚¹${price})</span>
        <span>â‚¹${total}</span>
      </div>`;
  });

  billBox.innerHTML += `
    <div class="bill-row bill-grand">
      <span>Grand Total</span>
      <span>â‚¹${grand}</span>
    </div>`;

  billBox.classList.remove("hidden");
}
</script>

</body>
</html>
